# 프로그래머스 SQL 문제 LV4 풀이

## 문제 이름

- 자료

  -  

- 조건

  -  

- 풀이

  1. ㅁ

  - ㅁ





## [보호소에서 중성화한 동물](https://school.programmers.co.kr/learn/courses/30/lessons/59045)

- 자료

  -  `ANIMAL_INS` 테이블 구조는 다음과 같으며, `ANIMAL_ID`, `ANIMAL_TYPE`, `DATETIME`, `INTAKE_CONDITION`, `NAME`, `SEX_UPON_INTAKE`는 각각 동물의 아이디, 생물 종, 보호 시작일, 보호 시작 시 상태, 이름, 성별 및 중성화 여부를 나타냅니다.
  -  `ANIMAL_OUTS` 테이블 구조는 다음과 같으며, `ANIMAL_ID`, `ANIMAL_TYPE`, `DATETIME`, `NAME`, `SEX_UPON_OUTCOME`는 각각 동물의 아이디, 생물 종, 입양일, 이름, 성별 및 중성화 여부를 나타냅니다. `ANIMAL_OUTS` 테이블의 `ANIMAL_ID`는 `ANIMAL_INS`의 `ANIMAL_ID`의 외래 키입니다.
  -  중성화를 거치지 않은 동물은 `성별 및 중성화 여부`에 `Intact`, 중성화를 거친 동물은 `Spayed` 또는 `Neutered`라고 표시되어있습니다. 

- 조건

  -  보호소에서 중성화 수술을 거친 동물 정보를 알아보려 합니다. 
  -  보호소에 들어올 당시에는 중성화되지 않았지만, 보호소를 나갈 당시에는 중성화된 동물의 
  -  아이디와 생물 종, 이름을 조회하는 
  -  아이디 순으로 조회하는 SQL 문을 작성해주세요.

- 풀이

  1. ANIMAL_INS에서 SEX_UPON_INTAKE이 'Intct'이면서
  2. ANIMAL_OUTS에서 SEX_UPON_OUTCOME이 'Sprayed' 또는 'Nuetered' 이면 된다.

  - JOIN 활용

    ```sql
    SELECT I.ANIMAL_ID, I.ANIMAL_TYPE, I.NAME
    FROM ANIMAL_INS AS I, ANIMAL_OUTS AS O
    WHERE I.ANIMAL_ID = O.ANIMAL_ID
    AND I.SEX_UPON_INTAKE LIKE 'Intact%'
    AND O.SEX_UPON_OUTCOME REGEXP('Neutered|Spayed')
    ORDER BY I.ANIMAL_ID
    ```

    

## [5월의 식품들 총매출 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/131117)

- 자료

  -  `FOOD_PRODUCT` 테이블은 다음과 같으며 `PRODUCT_ID`, `PRODUCT_NAME`, `PRODUCT_CD`, `CATEGORY`, `PRICE`는 식품 ID, 식품 이름, 식품코드, 식품분류, 식품 가격을 의미합니다.
  -  `FOOD_ORDER` 테이블은 다음과 같으며 `ORDER_ID`, `PRODUCT_ID`, `AMOUNT`, `PRODUCE_DATE`, `IN_DATE`, `OUT_DATE`, `FACTORY_ID`, `WAREHOUSE_ID`는 각각 주문 ID, 제품 ID, 주문량, 생산일자, 입고일자, 출고일자, 공장 ID, 창고 ID를 의미합니다.

- 조건

  -  생산일자가 2022년 5월인 식품들의 
  -  식품 ID, 식품 이름, 총매출을 조회하는 SQL문을 작성해주세요. 
  -  이때 결과는 총매출을 기준으로 내림차순 정렬해주시고 
  -  총매출이 같다면 식품 ID를 기준으로 오름차순 정렬해주세요.

- 풀이

  1. 식품 ID, 식품 이름은 FOOD_PRODUCT에서, 총 매출은 FOOD_ORDER에서 가져와야한다.
  2. 두 테이블의 같은 키는 '식품 ID'이다.
  3. GROUP BY를 식품 ID로 한다. 총 매출은 SUM(AMOUNT * PRICE)로 하자 (AMOUNT만 했다 틀림 ㅡㅡ)
  4. 2022-05는 LIKE로 한다.

  - JOIN 풀이

    ```sql
    SELECT P.PRODUCT_ID, P.PRODUCT_NAME, SUM(O.AMOUNT * P.PRICE) AS TOTAL_SALES
    FROM FOOD_PRODUCT AS P, FOOD_ORDER AS O
    WHERE P.PRODUCT_ID = O.PRODUCT_ID
    AND O.PRODUCE_DATE LIKE '2022-05%'
    GROUP BY O.PRODUCT_ID
    ORDER BY TOTAL_SALES DESC, O.PRODUCT_ID ASC
    ```

    

## [식품분류별 가장 비싼 식품의 정보 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/131116)

- 자료

  -  `FOOD_PRODUCT` 테이블은 다음과 같으며 `PRODUCT_ID`, `PRODUCT_NAME`, `PRODUCT_CD`, `CATEGORY`, `PRICE`는 식품 ID, 식품 이름, 식품코드, 식품분류, 식품 가격을 의미합니다.

- 조건

  -  식품분류별로 가격이 제일 비싼 식품의 분류, 가격, 이름을 조회하는 SQL문을 작성해주세요. 
  -  이때 식품분류가 '과자', '국', '김치', '식용유'인 경우만 출력시켜 주시고 
  -  결과는 식품 가격을 기준으로 내림차순 정렬해주세요.

- 풀이

  1. 서브쿼리로 식품 분류별 가장 가격이 비싼 식품을 찾아와야 한다.
     1. 근데 여기서 GROUP BY CATEGORY로 하면, 집계함수를 쓴 PRICE랑 CATEGORY는 잘 찾지만, 다른 컬럼들은 찾을 방법이 없다.
     2. 그래서 각 카테고리별로 비싼 가격은 하나일 테니깐 카테고리랑 가격을 기준으로 찾았다.
     3. 그리고 여기서 식품 분류도 제한했다.


  - 서브쿼리

    ```sql
    SELECT CATEGORY, PRICE, PRODUCT_NAME
    FROM FOOD_PRODUCT
    WHERE (CATEGORY, PRICE) IN (
        SELECT CATEGORY, MAX(PRICE)
        FROM FOOD_PRODUCT
        WHERE CATEGORY IN ('과자', '국', '김치', '식용유')
        GROUP BY CATEGORY
    )
    ORDER BY PRICE DESC
    ```

  - 다른 사람 풀이

    ```sql
    -- RANK
    SELECT CATEGORY, PRICE, PRODUCT_NAME
      FROM (SELECT CATEGORY, PRICE, PRODUCT_NAME,
                    RANK() OVER(PARTITION BY CATEGORY ORDER BY PRICE DESC) AS RANK
              FROM FOOD_PRODUCT
              WHERE CATEGORY IN ('과자', '국', '김치', '식용유'))
     WHERE RANK = 1
    ORDER BY PRICE DESC;
    ```

    ```sql
    -- ROW_NUMBER()
    SELECT CATEGORY, PRICE AS MAX_PRICE, PRODUCT_NAME
    FROM (
        SELECT CATEGORY, PRODUCT_NAME, PRODUCT_ID, PRICE
            ,ROW_NUMBER() OVER(PARTITION BY CATEGORY ORDER BY PRICE DESC) AS NO
        FROM FOOD_PRODUCT
        WHERE CATEGORY IN ('과자','국','김치','식용유')
    )
    WHERE NO = 1
    ORDER BY PRICE DESC
    ```

    

