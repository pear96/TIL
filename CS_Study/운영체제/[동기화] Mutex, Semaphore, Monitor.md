# 8. 뮤텍스와 세마포어의 차이점은 무엇인가요?  

> 뮤텍스와 세마포어는 멀티 스레드 또는 프로세스 간의 동기화를 위해 사용되는 도구입니다. 이 두 가지는 비슷한 목적을 가지고 있지만, 기능과 사용 방법에 약간의 차이가 있습니다.
>
> #### 뮤텍스 (Mutex):
>
> - 뮤텍스는 Mutual Exclusion의 줄임말로, ==한 번에 하나의 스레드만 공유 자원에 접근할 수 있도록 합니다.==
> - 뮤텍스는 보통 바이너리 락으로 사용되며, 락이 획득되면 다른 스레드는 락이 해제될 때까지 기다려야 합니다.
>   - 공유자원을 사용 중인 스레드가 있을 때, 다른 스레드가 공유자원에 접근한다면 Blocking 후 대기 큐로 보낸다.
>
> - 뮤텍스는 소유 개념이 있습니다. 즉, 락을 획득한 스레드만이 그 락을 해제할 수 있습니다.
> - 뮤텍스는 상호 배제를 위해 사용됩니다. 즉, 한 시점에 하나의 스레드만이 공유 자원에 접근할 수 있게 하는 것이 주 목적입니다.
>
> #### 세마포어 (Semaphore):
>
> - 세마포어는 공유 자원에 접근할 수 있는 스레드 또는 프로세스의 수를 제한하는 데 사용됩니다.
> - 세마포어는 정수 값을 가지며, 이 값은 ==동시에 리소스에 접근할 수 있는 최대 스레드 또는 프로세스 수를 나타냅니다.==
>   - 세마포어 변수를 통해 wait, signal 을 관리한다. 세마포어 변수는 0 이상의 정수형 변수를 갖는다.
> - 세마포어에는 소유 개념이 없습니다. 어떤 스레드나 프로세스도 세마포어를 증가시키거나 감소시킬 수 있습니다.
>   - 큐에 연결된 스레드를 깨우는 방식에 따라 **강성 세마포어(큐에 연결된 스레드를 깨울 때 FIFO 정책)**, **약성 세마포어(큐에 연결된 스레드를 깨울 때 순서를 특별히 명시하지 않음)**로 구분된다.
>   - Lock 을 걸지 않은 스레드도 Signal 을 보내 Lock 을 해제할 수 있다.
> - 세마포어는 제한된 수의 리소스를 여러 스레드나 프로세스가 공유하는 경우에 주로 사용됩니다.

- ### 이진 세마포어와 뮤텍스의 차이에 대해 설명해 주세요. 

> - 이진 세마포어는 세마포어의 한 형태로, 값이 0 또는 1만을 가질 수 있는 세마포어입니다.
> - 이진 세마포어도 상호 배제를 위해 사용될 수 있으며, 이 경우 뮤텍스와 비슷해 보일 수 있습니다.
> - 하지만 뮤텍스는 락을 획득한 스레드가 락을 해제해야 하는 소유권 개념이 있습니다. 반면 이진 세마포어는 그런 제약이 없습니다. 즉, 한 스레드가 세마포어를 감소시키고 다른 스레드가 증가시킬 수 있습니다.
> - 또한 뮤텍스는 일반적으로 우선 순위 상속과 같은 추가 메커니즘이 있어 상호 배제를 보다 효과적으로 처리하는데 사용됩니다.
>
> 결론적으로, 뮤텍스는 상호 배제를 위해 최적화되어 있으며 소유권이 중요한 경우 사용됩니다. 세마포어는 여러 스레드나 프로세스가 제한된 수의 리소스를 공유할 때 사용되며, 이진 세마포어는 값이 0 또는 1인 특별한 형태의 세마포어입니다. 이진 세마포어는 상호 배제를 수행할 수 있지만, 뮤텍스와 같은 소유권 개념은 없습니다.

## Busy Waiting = spinlock 

Mutex의 단점은 프로세스가 임계구역에 있는동안, 진입을 원하는 다른프로세스들은 `aquire()`함수를 호출하는 반복문을 계속 실행해야합니다.



- 뮤텍스와 세마포어 동작 과정

  > 💡 무한 반복을 하지 않고, 스레드가 스스로 잠잔다. lock을 반납하면 자는 애를 꺠워서 준다.
  >
  > 1. Race condition를 Mutex로 할 수 있는데, 세마포어는 어떻게??
  >    1. 어떻게든 락을 걸지 않는다.
  >    2. Mutex로 락을 건다… 그러면 대기하는 애가 무조건 생기니까 요즘엔 어떻게든 lock을 안걸려고 함
  > 2. 대기하는 프로세스들이 언제까지 대기해야하는가? 언제서야 대기하지 않고 자원을 가져갈 수 있는지 알 수 있는가? 

  > 뮤텍스(Mutex)와 세마포어(Semaphore)는 모두 동시성 제어를 위해 사용되는 동기화 기법입니다. 둘 모두 여러 쓰레드나 프로세스가 공유 자원에 동시에 접근하는 것을 방지하거나 순서를 제어하는데 사용됩니다.
  >
  > **1. 뮤텍스 (Mutex)**
  >
  > 뮤텍스는 "mutual exclusion"(상호 배제)의 약자로, 한 번에 하나의 쓰레드만 공유 자원에 접근할 수 있도록 하는데 사용됩니다. 뮤텍스는 락(lock)이라는 개념을 사용하여 이를 달성합니다. 쓰레드가 공유 자원에 접근하려면 먼저 뮤텍스 락을 얻어야 합니다. 락을 소유한 쓰레드만이 해당 자원에 접근할 수 있습니다. 이 쓰레드가 작업을 마치면 락을 반납(release)하고, 이후 다른 쓰레드가 락을 획득하고 공유 자원에 접근할 수 있습니다.
  >
  > **2. 세마포어 (Semaphore)**
  >
  > 세마포어는 뮤텍스와 유사하지만, 한 번에 여러 쓰레드가 공유 자원에 접근할 수 있도록 합니다. 세마포어는 정수 값을 가진 변수로, 이 값은 동시에 접근할 수 있는 쓰레드의 최대 수를 나타냅니다. 세마포어의 값이 0이면, 모든 쓰레드는 자원에 접근하는 것이 차단(blocked)되고, 세마포어의 값이 1 이상이면 쓰레드는 자원에 접근할 수 있습니다. 
  >
  > 세마포어는 두 가지 주요 연산, P (Proberen, 시도)와 V (Verhogen, 증가)를 통해 동작합니다. P 연산은 세마포어 값을 감소시키며, 세마포어 값이 0이면 쓰레드를 차단합니다. V 연산은 세마포어 값을 증가시키며, 차단된 쓰레드 중 하나를 임의로 선택해 실행을 재개합니다.
  >
  > 세마포어의 값이 최대 1인 경우, 세마포어는 뮤텍스와 동일하게 동작하며 이를 이진 세마포어(Binary Semaphore) 또는 뮤텍스 세마포어라고 부릅니다.

- 대기 중이다가 자원 획득 할 수 있는지 어떻게 아냐? = 대기하는 프로세스들이 언제까지 대기해야하는가? 언제서야 대기하지 않고 자원을 가져갈 수 있는지 알 수 있는가?

  > 뮤텍스나 세마포어 같은 동기화 메커니즘을 사용할 때, 쓰레드나 프로세스가 자원에 대한 접근을 시도하고 그 자원이 사용 중이면 대기 상태로 전환됩니다. 이런 상태를 보통 '락이 걸렸다'고 표현합니다. 이후 해당 자원이 해제되어 사용 가능해질 때(즉, 락이 풀릴 때), **스케줄러는 대기 중이던 프로세스 중 하나를 선택하여 실행 상태로 변경합니다.** 이 프로세스는 그제서야 자원을 획득하게 됩니다.
  >
  > 이런 방식을 통해, 여러 프로세스가 공유 자원에 대해 동시에 접근하려고 할 때 발생할 수 있는 경쟁 상황을 운영 체제가 관리하고 조절합니다. 이는 동시성 문제를 방지하고, 시스템의 안정성과 데이터의 일관성을 유지하는 데 도움을 줍니다.

  - Spin lock , busy waiting… while문에서 영원히 대기한다?
  - 무한 반복을 하지 않고, 스레드가 스스로 잠잔다. lock을 반납하면 자는 애를 꺠워서 준다.

- Race condition를 Mutex로 할 수 있는데, 세마포어는 어떻게??

  - 어떻게든 락을 걸지 않는다
  - Mutex로 락을 건다… 그러면 대기하는 애가 무조건 생기니까 요즘엔 어떻게든 lock을 안걸려고 

# Monitor

임계 구역을 지켜내기 위한 방법인 상호 배제를 **프로그램**으로 구현한 것이다. 세마포어는 wait & signal 연산 순서를 바꿔서 실행하거나 둘 중 하나라도 생략하면 상호배제를 위반하는 상황이나 교착 상태가 발생한다. wait & signal 연산이 프로그램 전체에 구성되어 있으면 세마포어의 영향이 미치는 곳이 어딘지 파악하기 어렵기 때문에 세마포어를 사용하여 프로그램을 구현하기 어렵다. 이러한 단점을 극복하기 위해 모니터가 등장했다. 모니터는 프로그래밍 언어 수준에서 제공된다. 대표적으로 Java 에서 제공한다. 순차적으로 사용할 수 있는 공유 자원 혹은 공유 자원 그룹을 할당하는 데 사용된다. **모니터는 이진 세마포어만 가능하다.** 모니터를 통해 프로세스가 자원에 접근하는 방식을 이미지로 보면 아래와 같다.

![image](https://user-images.githubusercontent.com/49058669/138542983-2f7517e3-94e1-4086-8084-f11a4d2345cc.png)

공유 자원에 점유 중인 프로세스(스레드)는 Lock 을 가지고 있다. 공유 자원을 점유 중인 프로세스(스레드)가 있는 상황에서 다른 프로세스(스레드)가 공유 자원에 접근하려고 하면 외부 모니터 준비 큐에서 진입을 `wait` 한다. Monitor 는 Semaphore 처럼 signal 연산을 보내는 것이 아니라 조건 변수를 사용하여 특정 조건에 대해 대기 큐에 signal 을 보내 작업을 시작시킨다.

![[Java] 뮤텍스, 세마포어, 모니터 - 모니터](https://blog.kakaocdn.net/dn/bcCYtX/btrpdpBFHBg/pHlcaSl5kbzSuUIcfTNDwk/img.png)

모니터는 공유 자원, 공유 자원 접근 함수로 이루어져 있고, 2개의 큐를 가지고 있다

- 상호 배타 큐 (Mutual Exclusion Queue)
  - 공유 자원에 하나의 프로세스만 진입하도록 하기 위한 큐이다. 공유 자원을 사용하는 스레드가 존재하면 상호 배타 큐에 존재한다.
- 조건 동기 큐 (Conditional Synchronization Queue)
  - 공유 자원의 Lock 이 해제되기를 기다리는 스레드가 대기하는 큐이다.