# Redis의 백업(RDB, AOF)

Redis는 인메모리이기 때문에 휘발성이라는 특성을 가진다. 따라서 백업이 중요하다.

백업에는 두 가지 방법이 있는데 특정한 시점의 스냅샷을 찍는 방법과, 모든 쓰기 명령에 대한 로그를 남기는 방법이 있다.

## RDB

- 특정 시점을 스냅샷으로 저장한다. 비교적 백업 파일 크기가 작으며 로딩 속도가 빠르다. 
- 그러나 스냅샷이 찍히기 전에 Redis가 종료되면, 마지막 백업과 종료 사이의 데이터는 복원할 수 없다. 스냅샷을 저장하는 시점의 데이터 변경사항은 저장되지 않을 수 있다.
- 

## AOF

- 쓰기 명령에 대한 로그를 남기고 파일 사이즈가 커지기 쉽다. 사이즈가 크기 때문에 로딩 속도도 느리다.
- 모든 변경 사항이 기록되기 때문에 데이터가 손실될 위험이 적다.
- 용량이 특정 사이즈보다 커지면 `rewrite`을 통해 사이즈를 줄인다. 
  - 만약 로그 중에 원하지 않는 명령을 지운다면, 반영된 상태로 복원된다.

### rewrite

AOF 파일이 특정 시점에 특정 사이즈를 넘긴다면 Redis의 현재 메모리 정보를 다시 AOF에 쓴다.



# Redis의 장애 복구

## Redis Replication(복제)

- master가 다운되면 replica중 하나를 마스터로 전환한다. 또한, read-only 의 연산을 분산시킬 수 있다.

## Redis Sentinel

Redis replication에서 마스터노드가 비정상적으로 종료되었을 때 자동으로 슬레이브 중 하나를 마스터로 승격시켜주는 역할을 한다.

센티넬 노드는 연결되어있으며 3개 이상인데, 과반수 이상이 동의해야 슬레이브 노드를 마스터 노드로 격상시키기 때문이다.